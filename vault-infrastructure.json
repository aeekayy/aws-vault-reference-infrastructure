{
"AWSTemplateFormatVersion" : "2010-09-09",
"Description" : "Hashicorp Vault Reference: Core Infrastructure: VPC, Subnets, Routing Tables, Routes, NAT and Internet Gateway",

	"Metadata" :
	{
	},

	"Parameters" :
  {
      "VPCCIDR" :
      {
        "Description" : "CIDR for Vault Reference VPC",
        "Type" : "String",
        "Default" : "10.0.0.0/16"
      },
      "CIDRForPublicSubnetA" :
      {
        "Description" : "CIDR for Vault Reference Public Subnet A",
        "Type" : "String",
        "Default" : "10.0.0.0/27"
      },
      "CIDRForPublicSubnetB" :
      {
        "Description" : "CIDR for Vault Reference Public Subnet B",
        "Type" : "String",
        "Default" : "10.0.0.32/27"
      },
      "CIDRForPublicSubnetC" :
      {
        "Description" : "CIDR for Vault Reference PublicSubnet C",
        "Type" : "String",
        "Default" : "10.0.0.64/27"
      },
      "CIDRForPrivateSubnetA" :
      {
        "Description" : "CIDR for Vault Reference Private Subnet A",
        "Type" : "String",
        "Default" : "10.0.0.96/27"
      },
      "CIDRForPrivateSubnetB" :
      {
        "Description" : "CIDR for Vault Reference Private Subnet B",
        "Type" : "String",
        "Default" : "10.0.0.128/27"
      },
      "CIDRForPrivateSubnetC" :
      {
        "Description" : "CIDR for Vault Reference Private Subnet C",
        "Type" : "String",
        "Default" : "10.0.0.160/27"
      }
	},

	"Mappings" :
	{
	},

	"Conditions" :
	{
	},

	"Resources" :
	{
   
  		"VaultRefVPC" :
  		{
      		"Type" : "AWS::EC2::VPC",
      		"Properties" :
      		{
        		  "CidrBlock" : { "Ref" : "VPCCIDR"} ,
        		  "Tags" :
					    [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"}},
						  {"Key" : "Name", "Value" : "Vault Reference VPC"}]
      		}
   		},

	    "VaultRefPublicSubnetA" :
	  	{
      		"Type" : "AWS::EC2::Subnet",
      		"Properties" :
			    {
        			"VpcId" : { "Ref" : "VaultRefVPC" },
        			"CidrBlock" : { "Ref" : "CIDRForPublicSubnetA" },
        			"AvailabilityZone" : "eu-west-1a",
        			"Tags" :
					    [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
					    {"Key" : "Name", "Value" : "Vault Reference Public Subnet A"}]
      		}
    	},

      "VaultRefPublicSubnetB" :
      {
          "Type" : "AWS::EC2::Subnet",
          "Properties" :
          {
                "VpcId" : { "Ref" : "VaultRefVPC" },
                "CidrBlock" : { "Ref" : "CIDRForPublicSubnetB" },
                "AvailabilityZone" : "eu-west-1b",
                "Tags" :
                [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
                {"Key" : "Name", "Value" : "Vault Reference Public Subnet B"}]
          }
      },

      "VaultRefPublicSubnetC" :
      {
          "Type" : "AWS::EC2::Subnet",
          "Properties" :
          {
                  "VpcId" : { "Ref" : "VaultRefVPC" },
                  "CidrBlock" : { "Ref" : "CIDRForPublicSubnetC" },
                  "AvailabilityZone" : "eu-west-1c",
                  "Tags" :
                  [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
                  {"Key" : "Name", "Value" : "Vault Reference Public Subnet C"}]
          }
      },

    	"VaultRefPrivateSubnetA" :
		  {
      		"Type" : "AWS::EC2::Subnet",
      		"Properties" :
			    {
        		"VpcId" : { "Ref" : "VaultRefVPC" },
        		"CidrBlock" : { "Ref" : "CIDRForPrivateSubnetA" },
        		"AvailabilityZone" : "eu-west-1a",
        		"Tags" :
					  [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Private Subnet A"}]
      		}
    	},

    	"VaultRefPrivateSubnetB" :
		  {
      		"Type" : "AWS::EC2::Subnet",
      		"Properties" :
			    {
        		"VpcId" : { "Ref" : "VaultRefVPC" },
        		"CidrBlock" : { "Ref" : "CIDRForPrivateSubnetB" },
        		"AvailabilityZone" : "eu-west-1b",
        		"Tags" :
					  [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Private Subnet B"}]
      		}
    	},
   
    	"VaultRefPrivateSubnetC" :
		  {
      		"Type" : "AWS::EC2::Subnet",
      		"Properties" :
			    {
        		"VpcId" : { "Ref" : "VaultRefVPC" },
        		"CidrBlock" : { "Ref" : "CIDRForPrivateSubnetC" },
        		"AvailabilityZone" : "eu-west-1c",
        		"Tags" :
					  [{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Private Subnet C"}]
      		}
    	},
    	
	    "VaultRefIGW" :
		  {
	      	"Type" : "AWS::EC2::InternetGateway",
	      	"Properties" :
				  {
	        	"Tags" :
						[{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Internet Gateway"}]
	      	}
	    },

	    "VaultRefAttachGateway" :
		  {
				  "Type" : "AWS::EC2::VPCGatewayAttachment",
				  "Properties" :
				  {
					  "VpcId" : { "Ref" : "VaultRefVPC" },
	         	"InternetGatewayId" : { "Ref" : "VaultRefIGW" }
	       	}
	    },

	    "VaultRefPublicRouteTable" :
		  {
				  "Type" : "AWS::EC2::RouteTable",
				  "Properties" :
				  {
	        	"VpcId" : {"Ref" : "VaultRefVPC"},
	        	"Tags" :
						[{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Public Routing Table"}]
				  }
	    },

	    "VaultRefPrivateRouteTable" :
      {
			    "Type" : "AWS::EC2::RouteTable",
				  "Properties" :
				  {
	          "VpcId" : {"Ref" : "VaultRefVPC"},
	        	"Tags" :
						[{"Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
						{"Key" : "Name", "Value" : "Vault Reference Private Routing Table"}]
          }
	    },

	    "VaultRefPublicRoute" :
		  {
	      	"Type" : "AWS::EC2::Route",
	      	"DependsOn" : "VaultRefAttachGateway",
	      	"Properties" :
				  {
	        		"RouteTableId" : { "Ref" : "VaultRefPublicRouteTable" },
	        		"DestinationCidrBlock" : "0.0.0.0/0",
	        		"GatewayId" : { "Ref" : "VaultRefIGW" }
	      	}
	    },
	    
	    "VaultRefPublicSubnetRouteTableAssociationA" :
		  {
				  "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	            "SubnetId" : { "Ref" : "VaultRefPublicSubnetA" },
	        		"RouteTableId" : { "Ref" : "VaultRefPublicRouteTable" }
	      	}
	    },
	    
	    "VaultRefPublicSubnetRouteTableAssociationB" :
		  {
				  "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	            "SubnetId" : { "Ref" : "VaultRefPublicSubnetB" },
	        		"RouteTableId" : { "Ref" : "VaultRefPublicRouteTable" }
	      	}
	    },
	    
	    "VaultRefPublicSubnetRouteTableAssociationC" :
		  {
				  "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	            "SubnetId" : { "Ref" : "VaultRefPublicSubnetC" },
	        		"RouteTableId" : { "Ref" : "VaultRefPublicRouteTable" }
	      	}
	    },
	    
		  "VaultRefPrivateSubnetRouteTableAssociationA" :
		  {
			    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	        		"SubnetId" : { "Ref" : "VaultRefPrivateSubnetA" },
	        		"RouteTableId" : { "Ref" : "VaultRefPrivateRouteTable" }
	      	}
	    },
	    
			"VaultRefPrivateSubnetRouteTableAssociationB" :
		  {
			    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	        		"SubnetId" : { "Ref" : "VaultRefPrivateSubnetB" },
	        		"RouteTableId" : { "Ref" : "VaultRefPrivateRouteTable" }
	      	}
	    },

			"VaultRefPrivateSubnetRouteTableAssociationC" :
		  {
			    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
	      	"Properties" :
				  {
	        		"SubnetId" : { "Ref" : "VaultRefPrivateSubnetC" },
	        		"RouteTableId" : { "Ref" : "VaultRefPrivateRouteTable" }
	      	}
	    },
	    
      "VaultRefNAT" :
      {
          "DependsOn" : "VaultRefAttachGateway",
          "Type" : "AWS::EC2::NatGateway",
          "Properties" :
          {
              "AllocationId" : { "Fn::GetAtt" : ["VaultRefEIP", "AllocationId"]},
              "SubnetId" : { "Ref" : "VaultRefPublicSubnetA"}
          }
      },
      
      "VaultRefEIP" :
      {
          "Type" : "AWS::EC2::EIP",
          "Properties" :
          {
              "Domain" : "vpc"
          }
      },
      
      "VaultRefPrivateRoute" :
      {
          "Type" : "AWS::EC2::Route",
          "Properties" :
          {
              "RouteTableId" : { "Ref" : "VaultRefPrivateRouteTable" },
              "DestinationCidrBlock" : "0.0.0.0/0",
              "NatGatewayId" : { "Ref" : "VaultRefNAT" }
          }
      }
	

	},

	"Outputs" :
	{
	}
}
